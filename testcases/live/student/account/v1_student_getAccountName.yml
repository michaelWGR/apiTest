- config:
    name: 根据手机号码获取账号名称
    variables:
      - account: ${yml(student.account.account1)}
      - deviceId: ${yml(student.default_device_id)}

- test:
    name: 获取token
    testcase: testcases\live\student\account\student_get_token.yml
    variables:
      account: $account
      deviceId: $deviceId
    output:
      - token
- test:
    name: 未获取验证码
    setup_hooks:
      - ${hook_print(Authorization token is :$token)}
    api: api/live/student/account/v1_student_getAccountName.yml
    variables:
      account: $account
      code: ${yml(student.account.default_auth_code)}
      token: $token
      deviceId: $deviceId
    validate:
      - eq: [content.code, 604]
      - eq: [content.msg, 验证码错误或超时]
      - eq: [content.success, false]

- test:
    name: 短信登录获取验证码
    api: api/live/student/account/v1_student_authCode.yml
    variables:
      account: $account
      deviceId: $deviceId
    validate:
      - eq: [status_code, 200]
      - eq: [content.code, 200]
      - eq: [content.msg, ok]
      - eq: [content.success, true]

- test:
    name: 正常获取账号名称
    setup_hooks:
      - ${hook_print(Authorization token is $token)}
    api: api/live/student/account/v1_student_getAccountName.yml
    variables:
      account: $account
      code: ${yml(student.account.default_auth_code)}
      token: $token
      deviceId: $deviceId
    validate:
      - eq: [content.code, 200]
      - eq: [content.msg, ok]
      - eq: [content.success, true]


- test:
    name: 设备id与登录时不一致
    api: api/live/student/account/v1_student_getAccountName.yml
    variables:
      account: $account
      code: ${yml(student.account.default_auth_code)}
      token: $token
      deviceId: 999999
    validate:
      - eq: [content.code, 703]
      - eq: [content.msg, accessToken error]
      - eq: [content.success, false]

- test:
    name: 缺少必填参数
    api: api/live/student/account/v1_student_getAccountName.yml
    variables:
      account: $account
      code: null
      token: $token
      deviceId: $deviceId
    validate:
      - eq: [content.code, 400]
      - eq: [content.msg, 参数错误]
      - eq: [content.success, false]

- test:
    name: 账号不存在
    api: api/live/student/account/v1_student_getAccountName.yml
    variables:
      account: 9999999999
      code: $account
      token: $token
      deviceId: $deviceId
    validate:
      - eq: [content.code, 601]
      - eq: [content.msg, 该账号不存在]
      - eq: [content.success, false]

- test:
    name: 验证码错误
    api: api/live/student/account/v1_student_getAccountName.yml
    variables:
      account: $account
      code: 018349
      token: $token
      deviceId: $deviceId
    validate:
      - eq: [content.code, 604]
      - eq: [content.msg, 验证码错误或超时]
      - eq: [content.success, false]

- test:
    name: 数据类型错误
    api: api/live/student/account/v1_student_getAccountName.yml
    variables:
      account: $account
      code: "wrong type"
      token: $token
      deviceId: $deviceId
    validate:
      - eq: [content.code, 604]
      - eq: [content.msg, 验证码错误或超时]
      - eq: [content.success, false]


- test:
    name: 缺少token
    api: api/live/student/account/v1_student_getAccountName.yml
    variables:
      account: $account
      code: ${yml(student.account.default_auth_code)}
      token: null
      deviceId: $deviceId
    validate:
      - eq: [content.code, 200]
      - eq: [content.msg, ok]
      - eq: [content.success, true]