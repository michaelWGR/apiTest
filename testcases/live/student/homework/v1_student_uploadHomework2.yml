- config:
    name: 学生上传作业2
    variables:
      true_roomUserScheduleId: '317985'
      already_commented_scheduleId: '316931'
      wrong_roomUserScheduleId: '989441111'
      not_empty_title: 接口测试用请勿点评
      not_empty_description: 测试作业上传接口2
      not_empty_pictureList: '[{"url":"https://hualala-live.oss-cn-shenzhen.aliyuncs.com/student_homework/picture/20191108/d4c02819-f5f3-4952-9dc4-a19da69dd75d.jpg"}]'
      wrong_pictureList: '[{"url":"https://hualala-live.oss-cn-shenzhen.aliyuncs.com/student_homework/picture/20191108/d4c02819-f5f3-4952-9dc4-123456789456.jpg"}]'
      not_empty_audioList: '[{"mediaLength":5,"url":"https://hualala-live.oss-cn-shenzhen.aliyuncs.com/student_homework/audio/20191108/4777319f-e05a-4064-ad56-4759a5072770.aac"}]'

- test:
    name: token 错误
    api: api/live/student/homework/v1_student_uploadHomework2.yml
    variables:
      token: null
      roomUserScheduleId: $true_roomUserScheduleId
      title: $not_empty_title
      description: $not_empty_description
      oldPictureIdList: "[]"
      oldAudioIdList: "[]"
      audioList: $not_empty_audioList
      pictureList: $not_empty_pictureList
    validate:
      - eq: [content.code, 703]
      - eq: [content.msg, accessToken error]

- test:
    name: get token
    testcase: testcases/live/student/account/student_get_token.yml
    variables:
      account: '12300020046'
    output:
      - token

- test:
    name: 获取用户作业
    api: api/live/student/homework/v1_student_getHomework.yml
    variables:
      roomUserScheduleId: $true_roomUserScheduleId
      token: $token
    validate:
      - eq: [content.code, 200]
      - eq: [content.success, true]
      - type_match: [content.data, dict]
    extract:
      - oldAudioList: content.data.audioResourceList
      - oldPictureList: content.data.picResourceList

- test:
    name: 缺少标题
    api: api/live/student/homework/v1_student_uploadHomework2.yml
    variables:
      token: $token
      roomUserScheduleId: $true_roomUserScheduleId
      title: null
      description: $not_empty_description
      oldPictureIdList: ${parse_resource_list($oldPictureList)}
      oldAudioIdList: ${parse_resource_list($oldAudioList)}
      pictureList: $not_empty_pictureList
      audioList: $not_empty_audioList
    validate:
      - eq: [content.code, 200]
      - eq: [content.msg, ok]
      - eq: [content.success, true]

- test:
    name: 缺少图片
    api: api/live/student/homework/v1_student_uploadHomework2.yml
    variables:
      token: $token
      roomUserScheduleId: $true_roomUserScheduleId
      title: null
      description: $not_empty_description
      oldPictureIdList: ${parse_resource_list($oldPictureList)}
      oldAudioIdList: ${parse_resource_list($oldAudioList)}
      pictureList: null
      audioList: $not_empty_audioList
    validate:
      - eq: [content.code, 200]
      - eq: [content.msg, ok]
      - eq: [content.success, true]

- test:
    name: 语音为空
    api: api/live/student/homework/v1_student_uploadHomework2.yml
    variables:
      token: $token
      roomUserScheduleId: $true_roomUserScheduleId
      title: null
      description: $not_empty_description
      oldPictureIdList: ${parse_resource_list($oldPictureList)}
      oldAudioIdList: ${parse_resource_list($oldAudioList)}
      pictureList: $not_empty_pictureList
      audioList: null
    validate:
      - eq: [content.code, 200]
      - eq: [content.msg, ok]
      - eq: [content.success, true]

- test:
    name: 历史资源id为空
    api: api/live/student/homework/v1_student_uploadHomework2.yml
    variables:
      token: $token
      roomUserScheduleId: $true_roomUserScheduleId
      title: null
      description: $not_empty_description
      oldPictureIdList: null
      oldAudioIdList: null
      pictureList: $not_empty_pictureList
      audioList: $not_empty_audioList
    validate:
      - eq: [content.code, 200]
      - eq: [content.msg, ok]
      - eq: [content.success, true]

- test:
    name: 无效资源链接
    api: api/live/student/homework/v1_student_uploadHomework2.yml
    variables:
      token: $token
      roomUserScheduleId: $true_roomUserScheduleId
      title: null
      description: $not_empty_description
      oldPictureIdList: ${parse_resource_list($oldPictureList)}
      oldAudioIdList: ${parse_resource_list($oldAudioList)}
      pictureList: $wrong_pictureList
      audioList: $not_empty_audioList
    validate:
      - eq: [content.code, 420]
      - eq: [content.msg, 作业上传保存失败]
      - eq: [content.success, false]

- test:
    name: 已点评的作业重新上传
    api: api/live/student/homework/v1_student_uploadHomework2.yml
    variables:
      token: $token
      roomUserScheduleId: $already_commented_scheduleId
      title: $not_empty_title
      description: $not_empty_description
      oldPictureIdList: ${parse_resource_list($oldPictureList)}
      oldAudioIdList: ${parse_resource_list($oldAudioList)}
      pictureList: $not_empty_pictureList
      audioList: $not_empty_audioList
    validate:
      - eq: [content.code, 420]
      - eq: [content.msg, '作业已经被点评,不可修改']
      - eq: [content.success, false]

- test:
    name: 上传作业
    api: api/live/student/homework/v1_student_uploadHomework2.yml
    variables:
      token: $token
      roomUserScheduleId: $true_roomUserScheduleId
      title: $not_empty_title
      description: $not_empty_description
      oldPictureIdList: ${parse_resource_list($oldPictureList)}
      oldAudioIdList: ${parse_resource_list($oldAudioList)}
      pictureList: $not_empty_pictureList
      audioList: $not_empty_audioList
    validate:
      - eq: [content.code, 200]
      - eq: [content.msg, ok]
      - eq: [content.success, true]
